<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard ‚Äì Black Pearl Shipyard</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/dashboard.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <div class="dash-layout">
        <!-- SIDEBAR -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-brand">
                <img src="../asset/logo.jpg" alt="Logo">
                <div class="brand-text">Black Pearl<small>Admin Panel</small></div>
            </div>
            <div class="sidebar-user">
                <div class="user-avatar" style="background:linear-gradient(135deg,#ff4d6d,#c9184a);">A</div>
                <div class="user-info">
                    <div class="user-name">Admin</div>
                    <div class="user-role" style="color:#ff4d6d;">Administrator</div>
                </div>
            </div>
            <nav class="sidebar-nav">
                <div class="nav-section-label">Overview</div>
                <a class="nav-item active" data-section="dashboard" onclick="showSection('dashboard')"><span
                        class="nav-icon">üìä</span>
                    Dashboard</a>
                <div class="nav-section-label">Management</div>
                <a class="nav-item" data-section="users" onclick="showSection('users')"><span class="nav-icon">üë•</span>
                    Users</a>
                <a class="nav-item" data-section="ship-orders" onclick="showSection('ship-orders')"><span
                        class="nav-icon">üö¢</span> Ship
                    Orders</a>
                <a class="nav-item" data-section="repairs" onclick="showSection('repairs')"><span
                        class="nav-icon">üîß</span> Ship Repairs</a>
                <a class="nav-item" data-section="tenders" onclick="showSection('tenders')"><span
                        class="nav-icon">üìë</span> Tenders</a>
                <a class="nav-item" data-section="inventory" onclick="showSection('inventory')"><span
                        class="nav-icon">üì¶</span> Inventory</a>
                <a class="nav-item" data-section="stock-exports" onclick="showSection('stock-exports')"><span
                        class="nav-icon">üì§</span> Stock
                    Exports</a>
                <div class="nav-section-label">Finance</div>
                <a class="nav-item" data-section="payments" onclick="showSection('payments')"><span
                        class="nav-icon">üí∞</span> Payments</a>
                <div class="nav-section-label">System</div>
                <a class="nav-item" data-section="notifications" onclick="showSection('notifications')"><span
                        class="nav-icon">üîî</span>
                    Notifications <span class="nav-badge">5</span></a>
                <a class="nav-item" data-section="reports" onclick="showSection('reports')"><span
                        class="nav-icon">üìà</span> Reports</a>
            </nav>
            <div class="sidebar-footer">
                <a class="nav-item" onclick="logout()" style="color:#ff4d6d;"><span class="nav-icon">üö™</span>
                    Logout</a>
            </div>
        </aside>

        <!-- MAIN -->
        <div class="dash-main">
            <div class="topbar">
                <div class="topbar-left">
                    <button class="sidebar-toggle"
                        onclick="document.getElementById('sidebar').classList.toggle('open')">‚ò∞</button>
                    <div class="page-title" id="pageTitle">Admin Dashboard</div>
                </div>
                <div class="topbar-right">
                    <div class="topbar-icon-btn" onclick="showSection('notifications')">üîî<span
                            class="notif-dot"></span></div>
                    <div class="topbar-user">
                        <div class="user-avatar" style="background:linear-gradient(135deg,#ff4d6d,#c9184a);">A</div>
                        <span class="user-name">Admin</span>
                    </div>
                </div>
            </div>

            <div class="dash-content">

                <!-- ‚îÄ‚îÄ DASHBOARD ‚îÄ‚îÄ -->
                <div class="dash-section active" id="sec-dashboard">
                    <div class="stat-cards">
                        <div class="stat-card" style="--accent:#FFD700;">
                            <div class="stat-card-icon gold">üë•</div>
                            <div class="stat-card-info">
                                <div class="stat-value" id="statTotalUsers">‚Äì</div>
                                <div class="stat-label">Total Users</div>
                                <div class="stat-change up">‚Üë Live from DB</div>
                            </div>
                        </div>
                        <div class="stat-card" style="--accent:#00aced;">
                            <div class="stat-card-icon blue">üö¢</div>
                            <div class="stat-card-info">
                                <div class="stat-value" id="statTotalOrders">‚Äì</div>
                                <div class="stat-label">Ship Orders</div>
                                <div class="stat-change up">‚Üë Live from DB</div>
                            </div>
                        </div>
                        <div class="stat-card" style="--accent:#00c896;">
                            <div class="stat-card-icon green">üìë</div>
                            <div class="stat-card-info">
                                <div class="stat-value" id="statActiveTenders">‚Äì</div>
                                <div class="stat-label">Active Tenders</div>
                                <div class="stat-change up">‚Üë Open this month</div>
                            </div>
                        </div>
                        <div class="stat-card" style="--accent:#a78bfa;">
                            <div class="stat-card-icon purple">üí∞</div>
                            <div class="stat-card-info">
                                <div class="stat-value" id="statMonthRevenue">‚Äì</div>
                                <div class="stat-label">Revenue (Month)</div>
                                <div class="stat-change up">‚Üë Completed payments</div>
                            </div>
                        </div>
                    </div>

                    <div class="chart-grid">
                        <div class="dash-card">
                            <div class="dash-card-header">
                                <h3><span class="card-icon">üìä</span> Monthly Revenue</h3>
                            </div>
                            <div class="dash-card-body">
                                <div class="chart-container"><canvas id="revenueChart"></canvas></div>
                            </div>
                        </div>
                        <div class="dash-card">
                            <div class="dash-card-header">
                                <h3><span class="card-icon">üö¢</span> Order Status Distribution</h3>
                            </div>
                            <div class="dash-card-body">
                                <div class="chart-container"><canvas id="orderStatusChart"></canvas></div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Orders -->
                    <div class="dash-card">
                        <div class="dash-card-header">
                            <h3><span class="card-icon">üö¢</span> Recent Ship Orders</h3><a
                                onclick="showSection('ship-orders')" class="btn-glass"
                                style="font-size:0.8rem;padding:6px 14px;cursor:pointer;">View All</a>
                        </div>
                        <div class="dash-card-body" style="padding:0;">
                            <div style="overflow-x:auto;">
                                <table class="dash-table">
                                    <thead>
                                        <tr>
                                            <th>Order ID</th>
                                            <th>User</th>
                                            <th>Ship Type</th>
                                            <th>Value</th>
                                            <th>Date</th>
                                            <th>Status</th>
                                            <th>Action</th>
                                        </tr>
                                    </thead>
                                    <tbody id="recentOrdersBody">
                                        <tr>
                                            <td colspan="7" style="text-align:center;color:#8fa8c0;padding:24px;">
                                                Loading recent orders...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- ‚îÄ‚îÄ USERS ‚îÄ‚îÄ -->
                <div class="dash-section" id="sec-users">
                    <div class="dash-card">
                        <div class="dash-card-header">
                            <h3><span class="card-icon">üë•</span> User Management</h3>
                            <button class="btn-primary-gold" style="font-size:0.82rem;padding:8px 16px;"
                                onclick="openModal('addUserModal')">+ Add User</button>
                        </div>
                        <div class="dash-card-body" style="padding:0;">
                            <div style="padding:16px;border-bottom:1px solid rgba(255,255,255,0.06);">
                                <input type="text" class="form-control" placeholder="üîç Search users..."
                                    style="max-width:300px;" oninput="filterUsers(this.value)">
                            </div>
                            <div style="overflow-x:auto;">
                                <table class="dash-table" id="usersTable">
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>Name</th>
                                            <th>Email</th>
                                            <th>Department</th>
                                            <th>Role</th>
                                            <th>Joined</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="usersBody"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ‚îÄ‚îÄ SHIP ORDERS ‚îÄ‚îÄ -->
                <div class="dash-section" id="sec-ship-orders">
                    <div class="dash-card">
                        <div class="dash-card-header">
                            <h3><span class="card-icon">üö¢</span> All Ship Orders</h3>
                        </div>
                        <div class="dash-card-body" style="padding:0;">
                            <div style="overflow-x:auto;">
                                <table class="dash-table">
                                    <thead>
                                        <tr>
                                            <th>Order ID</th>
                                            <th>User</th>
                                            <th>Ship Type</th>
                                            <th>Tonnage</th>
                                            <th>Material</th>
                                            <th>Submitted</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="ordersBody"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ‚îÄ‚îÄ REPAIRS ‚îÄ‚îÄ -->
                <div class="dash-section" id="sec-repairs">
                    <div class="dash-card">
                        <div class="dash-card-header">
                            <h3><span class="card-icon">üîß</span> Ship Repair Requests</h3>
                        </div>
                        <div class="dash-card-body" style="padding:0;">
                            <div style="overflow-x:auto;">
                                <table class="dash-table">
                                    <thead>
                                        <tr>
                                            <th>Request ID</th>
                                            <th>User</th>
                                            <th>Vessel</th>
                                            <th>Issue</th>
                                            <th>Priority</th>
                                            <th>Date</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="repairsBody"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ‚îÄ‚îÄ TENDERS ‚îÄ‚îÄ -->
                <div class="dash-section" id="sec-tenders">
                    <div class="dash-card">
                        <div class="dash-card-header">
                            <h3><span class="card-icon">üìë</span> Tender Management</h3>
                            <button class="btn-primary-gold" style="font-size:0.82rem;padding:8px 16px;"
                                onclick="openModal('addTenderModal')">+ Add Tender</button>
                        </div>
                        <div class="dash-card-body" style="padding:0;">
                            <div style="overflow-x:auto;">
                                <table class="dash-table">
                                    <thead>
                                        <tr>
                                            <th>Tender No.</th>
                                            <th>Title</th>
                                            <th>Category</th>
                                            <th>Value</th>
                                            <th>Applications</th>
                                            <th>Closing</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tendersBody"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ‚îÄ‚îÄ INVENTORY ‚îÄ‚îÄ -->
                <div class="dash-section" id="sec-inventory">
                    <div class="dash-card">
                        <div class="dash-card-header">
                            <h3><span class="card-icon">üì¶</span> Inventory Management</h3>
                            <button class="btn-primary-gold" style="font-size:0.82rem;padding:8px 16px;"
                                onclick="openModal('addItemModal')">+ Add Item</button>
                        </div>
                        <div class="dash-card-body" style="padding:0;">
                            <div style="overflow-x:auto;">
                                <table class="dash-table">
                                    <thead>
                                        <tr>
                                            <th>Item ID</th>
                                            <th>Name</th>
                                            <th>Category</th>
                                            <th>Qty</th>
                                            <th>Unit</th>
                                            <th>Unit Price</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="inventoryBody"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ‚îÄ‚îÄ STOCK EXPORTS ‚îÄ‚îÄ -->
                <div class="dash-section" id="sec-stock-exports">
                    <div class="dash-card">
                        <div class="dash-card-header">
                            <h3><span class="card-icon">üì§</span> Stock Export Requests</h3>
                        </div>
                        <div class="dash-card-body" style="padding:0;">
                            <div style="overflow-x:auto;">
                                <table class="dash-table">
                                    <thead>
                                        <tr>
                                            <th>Request ID</th>
                                            <th>User</th>
                                            <th>Item</th>
                                            <th>Qty</th>
                                            <th>Purpose</th>
                                            <th>Date</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="exportsBody"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ‚îÄ‚îÄ PAYMENTS ‚îÄ‚îÄ -->
                <div class="dash-section" id="sec-payments">
                    <div class="dash-card">
                        <div class="dash-card-header">
                            <h3><span class="card-icon">üí∞</span> Payment Records</h3>
                        </div>
                        <div class="dash-card-body" style="padding:0;">
                            <div style="overflow-x:auto;">
                                <table class="dash-table">
                                    <thead>
                                        <tr>
                                            <th>Payment ID</th>
                                            <th>User</th>
                                            <th>Reference</th>
                                            <th>Amount</th>
                                            <th>Method</th>
                                            <th>Date</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody id="paymentsBody"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ‚îÄ‚îÄ NOTIFICATIONS ‚îÄ‚îÄ -->
                <div class="dash-section" id="sec-notifications">
                    <div class="dash-card">
                        <div class="dash-card-header">
                            <h3><span class="card-icon">üîî</span> Send Notification</h3>
                        </div>
                        <div class="dash-card-body">
                            <form onsubmit="sendNotification(event)" style="max-width:600px;">
                                <div class="form-group"><label class="form-label">Target</label><select
                                        class="form-control">
                                        <option>All Users</option>
                                        <option>Specific User</option>
                                        <option>All Admins</option>
                                    </select></div>
                                <div class="form-group"><label class="form-label">Title</label><input type="text"
                                        name="notifTitle" class="form-control" placeholder="Notification title"
                                        required></div>
                                <div class="form-group"><label class="form-label">Message</label><textarea
                                        name="notifMsg" class="form-control" rows="3"
                                        placeholder="Notification message..." required></textarea></div>
                                <div class="form-group"><label class="form-label">Type</label><select name="notifType"
                                        class="form-control">
                                        <option value="INFO">Info</option>
                                        <option value="WARNING">Warning</option>
                                        <option value="SUCCESS">Success</option>
                                        <option value="ALERT">Alert</option>
                                    </select></div>
                                <button type="submit" class="btn-primary-gold">Send Notification</button>
                            </form>
                        </div>
                    </div>
                    <div class="dash-card" style="margin-top:20px;">
                        <div class="dash-card-header">
                            <h3><span class="card-icon">üìã</span> Recent Notifications Sent</h3>
                        </div>
                        <div class="dash-card-body">
                            <div class="notif-list" id="recentNotifications">
                                <div class="notif-item">
                                    <div class="notif-dot-icon blue"></div>
                                    <div>
                                        <div class="notif-text">Loading notifications...</div>
                                        <div class="notif-time">Just now</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- ‚îÄ‚îÄ REPORTS ‚îÄ‚îÄ -->
                <div class="dash-section" id="sec-reports">
                    <div class="stat-cards">
                        <div class="stat-card" style="--accent:#FFD700;">
                            <div class="stat-card-icon gold">üö¢</div>
                            <div class="stat-card-info">
                                <div class="stat-value">‚Çπ420Cr</div>
                                <div class="stat-label">Annual Revenue</div>
                                <div class="stat-change up">‚Üë 22% YoY</div>
                            </div>
                        </div>
                        <div class="stat-card" style="--accent:#00c896;">
                            <div class="stat-card-icon green">‚úÖ</div>
                            <div class="stat-card-info">
                                <div class="stat-value">28</div>
                                <div class="stat-label">Orders Completed</div>
                                <div class="stat-change up">‚Üë 8 this quarter</div>
                            </div>
                        </div>
                        <div class="stat-card" style="--accent:#00aced;">
                            <div class="stat-card-icon blue">üìë</div>
                            <div class="stat-card-info">
                                <div class="stat-value">48</div>
                                <div class="stat-label">Tender Applications</div>
                                <div class="stat-change up">‚Üë 15 approved</div>
                            </div>
                        </div>
                        <div class="stat-card" style="--accent:#a78bfa;">
                            <div class="stat-card-icon purple">‚≠ê</div>
                            <div class="stat-card-info">
                                <div class="stat-value">98.2%</div>
                                <div class="stat-label">On-Time Delivery</div>
                                <div class="stat-change up">‚Üë Industry leading</div>
                            </div>
                        </div>
                    </div>
                    <div class="chart-grid">
                        <div class="dash-card">
                            <div class="dash-card-header">
                                <h3><span class="card-icon">üìà</span> Quarterly Revenue</h3>
                            </div>
                            <div class="dash-card-body">
                                <div class="chart-container"><canvas id="quarterlyChart"></canvas></div>
                            </div>
                        </div>
                        <div class="dash-card">
                            <div class="dash-card-header">
                                <h3><span class="card-icon">üö¢</span> Orders by Ship Type</h3>
                            </div>
                            <div class="dash-card-body">
                                <div class="chart-container"><canvas id="shipTypeChart"></canvas></div>
                            </div>
                        </div>
                    </div>
                    <div class="dash-card">
                        <div class="dash-card-header">
                            <h3><span class="card-icon">üì•</span> Export Reports as CSV</h3>
                        </div>
                        <div class="dash-card-body">
                            <div
                                style="display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:12px;">
                                <button class="btn-outline-gold" onclick="exportCSV('orders')">üì¶ Export Orders
                                    CSV</button>
                                <button class="btn-outline-gold" onclick="exportCSV('repairs')">üîß Export Repairs
                                    CSV</button>
                                <button class="btn-outline-gold" onclick="exportCSV('tenders')">üìë Export Tenders
                                    CSV</button>
                                <button class="btn-outline-gold" onclick="exportCSV('inventory')">üìä Export Inventory
                                    CSV</button>
                                <button class="btn-outline-gold" onclick="exportCSV('exports')">üì§ Export Stock Exports
                                    CSV</button>
                                <button class="btn-outline-gold" onclick="exportCSV('payments')">üí∞ Export Payments
                                    CSV</button>
                                <button class="btn-glass" onclick="exportCSV('all')">üìã Export All Data (Full
                                    Report)</button>
                                <button class="btn-glass"
                                    onclick="showToast('Report sent to admin@blackpearlshipyard.com','info')">‚úâÔ∏è Email
                                    Report</button>
                            </div>
                        </div>
                    </div>
                </div>

            </div><!-- /dash-content -->
        </div><!-- /dash-main -->
    </div><!-- /dash-layout -->

    <!-- MODALS -->
    <div class="modal-overlay" id="addUserModal">
        <div class="modal-box">
            <div class="modal-header">
                <h3>üë§ Add New User</h3><button class="modal-close" onclick="closeModal('addUserModal')">‚úï</button>
            </div>
            <div class="modal-body">
                <form onsubmit="AdminModule.addUser(event)">
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;">
                        <div class="form-group"><label class="form-label">First Name</label><input type="text"
                                name="firstName" class="form-control" required></div>
                        <div class="form-group"><label class="form-label">Last Name</label><input type="text"
                                name="lastName" class="form-control" required></div>
                    </div>
                    <div class="form-group"><label class="form-label">Email</label><input type="email" name="email"
                            class="form-control" required></div>
                    <div class="form-group"><label class="form-label">Department</label><select name="department"
                            class="form-control">
                            <option value="ENGINEERING">Engineering</option>
                            <option value="OPERATIONS">Operations</option>
                            <option value="PROCUREMENT">Procurement</option>
                            <option value="FINANCE">Finance</option>
                            <option value="ADMINISTRATION">Administration</option>
                            <option value="QUALITY_CONTROL">Quality Control</option>
                            <option value="SAFETY">Safety</option>
                        </select></div>
                    <div class="form-group"><label class="form-label">Role</label><select name="role"
                            class="form-control">
                            <option value="USER">USER</option>
                            <option value="ADMIN">ADMIN</option>
                        </select></div>
                    <div class="form-group"><label class="form-label">Password</label><input type="password"
                            name="password" class="form-control" required></div>
                    <div class="modal-footer"><button type="button" class="btn-glass"
                            onclick="closeModal('addUserModal')">Cancel</button><button type="submit"
                            class="btn-primary-gold">Add User</button></div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit User Modal -->
    <div class="modal-overlay" id="editUserModal">
        <div class="modal-box">
            <div class="modal-header">
                <h3>üë§ Edit User</h3><button class="modal-close" onclick="closeModal('editUserModal')">‚úï</button>
            </div>
            <div class="modal-body">
                <form id="editUserForm" onsubmit="AdminModule.saveEditUser(event)">
                    <input type="hidden" name="id" id="editUserId">
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;">
                        <div class="form-group"><label class="form-label">First Name</label><input type="text"
                                name="firstName" id="editUserFirstName" class="form-control" required></div>
                        <div class="form-group"><label class="form-label">Last Name</label><input type="text"
                                name="lastName" id="editUserLastName" class="form-control" required></div>
                    </div>
                    <div class="form-group"><label class="form-label">Department</label><select name="department"
                            id="editUserDept" class="form-control">
                            <option value="ENGINEERING">Engineering</option>
                            <option value="OPERATIONS">Operations</option>
                            <option value="PROCUREMENT">Procurement</option>
                            <option value="FINANCE">Finance</option>
                            <option value="ADMINISTRATION">Administration</option>
                            <option value="QUALITY_CONTROL">Quality Control</option>
                            <option value="SAFETY">Safety</option>
                        </select></div>
                    <div class="form-group"><label class="form-label">Role</label><select name="role" id="editUserRole"
                            class="form-control">
                            <option value="USER">USER</option>
                            <option value="ADMIN">ADMIN</option>
                        </select></div>
                    <div class="modal-footer"><button type="button" class="btn-glass"
                            onclick="closeModal('editUserModal')">Cancel</button><button type="submit"
                            class="btn-primary-gold">Update User</button></div>
                </form>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="addTenderModal">
        <div class="modal-box">
            <div class="modal-header">
                <h3>üìë Add New Tender</h3><button class="modal-close" onclick="closeModal('addTenderModal')">‚úï</button>
            </div>
            <div class="modal-body">
                <form onsubmit="AdminModule.createTender(event)">
                    <div class="form-group"><label class="form-label">Tender Title *</label><input type="text"
                            name="title" class="form-control" required></div>
                    <div class="form-group"><label class="form-label">Category</label><select name="category"
                            class="form-control">
                            <option value="Ship Building">Ship Building</option>
                            <option value="Ship Repair">Ship Repair</option>
                            <option value="Supply">Supply</option>
                            <option value="Civil Works">Civil Works</option>
                            <option value="IT Services">IT Services</option>
                        </select></div>
                    <div class="form-group"><label class="form-label">Value (‚Çπ Cr) *</label><input type="number"
                            name="value" class="form-control" step="0.01" required></div>
                    <div class="form-group"><label class="form-label">Closing Date *</label><input type="date"
                            name="closingDate" class="form-control" required></div>
                    <div class="form-group"><label class="form-label">Description</label><textarea name="description"
                            class="form-control" rows="3"></textarea></div>
                    <div class="modal-footer"><button type="button" class="btn-glass"
                            onclick="closeModal('addTenderModal')">Cancel</button><button type="submit"
                            class="btn-primary-gold">Publish Tender</button></div>
                </form>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="addItemModal">
        <div class="modal-box">
            <div class="modal-header">
                <h3>üì¶ Add Inventory Item</h3><button class="modal-close"
                    onclick="closeModal('addItemModal')">‚úï</button>
            </div>
            <div class="modal-body">
                <form onsubmit="AdminModule.addInventoryItem(event)">
                    <div class="form-group"><label class="form-label">Item Name *</label><input type="text" name="name"
                            class="form-control" required></div>
                    <div class="form-group"><label class="form-label">Category</label><select name="category"
                            class="form-control">
                            <option value="Marine Engines">Marine Engines</option>
                            <option value="Steel & Metal">Steel & Metal</option>
                            <option value="Electrical">Electrical</option>
                            <option value="Navigation">Navigation</option>
                            <option value="Safety Equipment">Safety Equipment</option>
                            <option value="Hydraulics">Hydraulics</option>
                        </select></div>
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;">
                        <div class="form-group"><label class="form-label">Quantity *</label><input type="number"
                                name="quantity" class="form-control" required></div>
                        <div class="form-group"><label class="form-label">Unit</label><select name="unit"
                                class="form-control">
                                <option value="Unit">Unit</option>
                                <option value="Ton">Ton</option>
                                <option value="Meter">Meter</option>
                                <option value="Set">Set</option>
                                <option value="Can">Can</option>
                            </select></div>
                    </div>
                    <div class="form-group"><label class="form-label">Unit Price (‚Çπ)</label><input type="text"
                            name="unitPrice" class="form-control" placeholder="e.g. 24000000"></div>
                    <div class="modal-footer"><button type="button" class="btn-glass"
                            onclick="closeModal('addItemModal')">Cancel</button><button type="submit"
                            class="btn-primary-gold">Add Item</button></div>
                </form>
            </div>
        </div>
    </div>

    <div class="toast-container" id="toastContainer"></div>

    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/admin.js"></script>
    <script>
        // Route Guard
        Auth.requireAuth(true);

        function showSection(id) {
            document.querySelectorAll('.dash-section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById('sec-' + id).classList.add('active');
            const titles = { dashboard: 'Admin Dashboard', users: 'User Management', 'ship-orders': 'Ship Orders', repairs: 'Ship Repairs', tenders: 'Tender Management', inventory: 'Inventory', 'stock-exports': 'Stock Exports', payments: 'Payments', notifications: 'Notifications', reports: 'Reports' };
            document.getElementById('pageTitle').textContent = titles[id] || id;
            if (event && event.currentTarget) event.currentTarget.classList.add('active');
            if (id === 'reports') initReportCharts();
            // Trigger live API load for the newly visible section
            if (typeof AdminModule !== 'undefined') AdminModule.onSectionShown(id);
        }

        function openModal(id) { document.getElementById(id).classList.add('open'); }
        function closeModal(id) { document.getElementById(id).classList.remove('open'); }
        document.querySelectorAll('.modal-overlay').forEach(m => m.addEventListener('click', e => { if (e.target === m) m.classList.remove('open'); }));

        function showToast(msg, type = 'info') {
            const icons = { success: '‚úÖ', error: '‚ùå', warning: '‚ö†Ô∏è', info: '‚ÑπÔ∏è' };
            const t = document.createElement('div');
            t.className = `toast ${type}`;
            t.innerHTML = `<span class="toast-icon">${icons[type]}</span><span class="toast-msg">${msg}</span><button class="toast-close" onclick="this.parentElement.remove()">‚úï</button>`;
            document.getElementById('toastContainer').appendChild(t);
            setTimeout(() => t.remove(), 4000);
        }

        // User info from storage
        const user = Auth.getUser() || { email: 'admin@blackpearl.com' };
        const name = user.email ? user.email.split('@')[0] : 'Admin';
        const initial = name.charAt(0).toUpperCase();
        document.querySelectorAll('.user-name').forEach(el => el.textContent = name);
        document.querySelectorAll('.user-avatar').forEach(el => el.textContent = initial);

        function logout() { Auth.logout(); }
        // Load dashboard data on page load
        if (typeof AdminModule !== 'undefined') AdminModule.init();

        let reportChartsInit = false;

        function initReportCharts() {
            if (reportChartsInit) return;
            reportChartsInit = true;
            new Chart(document.getElementById('quarterlyChart'), {
                type: 'line',
                data: {
                    labels: ['Q1 2024', 'Q2 2024', 'Q3 2024', 'Q4 2024', 'Q1 2025'],
                    datasets: [{ label: 'Revenue (‚Çπ Cr)', data: [85, 102, 115, 118, 120], borderColor: '#FFD700', backgroundColor: 'rgba(255,215,0,0.1)', tension: 0.4, fill: true }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { labels: { color: '#8fa8c0' } } }, scales: { x: { ticks: { color: '#8fa8c0' }, grid: { color: 'rgba(255,255,255,0.05)' } }, y: { ticks: { color: '#8fa8c0' }, grid: { color: 'rgba(255,255,255,0.05)' } } } }
            });
            new Chart(document.getElementById('shipTypeChart'), {
                type: 'pie',
                data: {
                    labels: ['Cargo Vessel', 'Patrol Boat', 'Tanker', 'Luxury Yacht', 'Fishing Vessel', 'Naval'],
                    datasets: [{ data: [12, 8, 5, 4, 3, 2], backgroundColor: ['#FFD700', '#00aced', '#a78bfa', '#00c896', '#ffa500', '#ff4d6d'], borderWidth: 0 }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'right', labels: { color: '#8fa8c0' } } } }
            });
        }

        function exportCSV(type) {
            const o = window.__adminOrders || [], r = window.__adminRepairs || [], t = window.__adminTenders || [];
            const inv = window.__adminInventory || [], exp = window.__adminExports || [], pay = window.__adminPayments || [];
            const datasets = {
                orders: {
                    headers: ['Order ID', 'Customer', 'Ship Type', 'Tonnage', 'Date', 'Status'],
                    rows: o.map(x => [x.id, x.userEmail || '-', x.shipType, x.tonnage || '-', x.expectedDelivery || '-', x.status])
                },
                repairs: {
                    headers: ['Repair ID', 'Customer', 'Vessel', 'Issue', 'Priority', 'Status'],
                    rows: r.map(x => [x.id, x.userEmail || '-', x.vesselName, x.issueType || '-', x.priority, x.status])
                },
                tenders: {
                    headers: ['Tender No', 'Title', 'Category', 'Value', 'Closing Date', 'Status'],
                    rows: t.map(x => [x.tenderNo || x.tender_no, `"${(x.title || '').replace(/"/g, '""')}"`, x.category || '-', x.value || '-', x.closingDate || x.closing_date || '-', x.status])
                },
                inventory: {
                    headers: ['Item Code', 'Name', 'Category', 'Quantity', 'Unit', 'Price', 'Status'],
                    rows: inv.map(x => [x.itemCode || x.id, `"${(x.name || '').replace(/"/g, '""')}"`, x.category || '-', x.quantity, x.unit || '-', x.unitPrice || '-', x.status])
                },
                exports: {
                    headers: ['Export ID', 'Customer', 'Item', 'Quantity', 'Purpose', 'Status'],
                    rows: exp.map(x => [x.id, x.userEmail || '-', `"${(x.itemName || '-').replace(/"/g, '""')}"`, x.quantity, x.purpose || '-', x.status])
                },
                payments: {
                    headers: ['Payment ID', 'Customer', 'Amount', 'Method', 'Status'],
                    rows: pay.map(x => [x.id, x.userEmail || x.userName || '-', x.amount, x.method || '-', x.status])
                }
            };
            if (type === 'all') {
                let allContent = '';
                Object.entries(datasets).forEach(([key, ds]) => {
                    allContent += `\n=== ${key.toUpperCase()} ===\n`;
                    allContent += [ds.headers.join(','), ...ds.rows.map(r => r.join(','))].join('\n') + '\n';
                });
                const blob = new Blob([allContent], { type: 'text/csv' });
                const a = document.createElement('a'); a.href = URL.createObjectURL(blob);
                a.download = `BlackPearl_Full_Report_${new Date().toISOString().slice(0, 10)}.csv`; a.click();
                showToast('Full report downloaded!', 'success');
                return;
            }
            const ds = datasets[type];
            if (!ds) return;
            const csv = [ds.headers.join(','), ...ds.rows.map(r => r.join(','))].join('\n');
            const blob = new Blob([csv], { type: 'text/csv' });
            const a = document.createElement('a'); a.href = URL.createObjectURL(blob);
            a.download = `BlackPearl_${type}_${new Date().toISOString().slice(0, 10)}.csv`; a.click();
            showToast(`${type.charAt(0).toUpperCase() + type.slice(1)} report downloaded!`, 'success');
        }

        // Users load via AdminModule.onSectionShown('users') when section is opened
    </script>
</body>

</html>